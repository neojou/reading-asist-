# ğŸ”® Synthesizer â€” æ˜‡è¯èˆ‡æ¹§ç¾æ´è¦‹å ±å‘Š

> **ä»»å‹™**ï¼šæ•´åˆ Verifier çš„äº‹å¯¦æŸ¥æ ¸ã€Critic çš„è«–è¿°ä¿®æ­£ï¼Œé€²è¡Œè·¨åŸŸé€£çµï¼Œæå‡ºå¯æ¸¬è©¦å‡èªªï¼Œä¸¦ç‚ºç¶²èªŒæ‰¾å‡ºæœ€æœ‰åŠ›çš„æ•˜äº‹æ¡†æ¶ã€‚

***

## ä¸€ã€æ•´åˆæ­£åé¢è«–é»

å¾ Verifier + Critic çš„å·¥ä½œä¸­ï¼Œå¯ä»¥æç…‰å‡ºé€™å€‹æ ¸å¿ƒå¼µåŠ›ï¼š


| é¢å‘ | åŸæ–‡ç«‹å ´ | ä¿®æ­£å¾Œçš„æº–ç¢ºç«‹å ´ |
| :-- | :-- | :-- |
| Rust çš„ä¿è­‰å¼·åº¦ | ã€Œä¿è­‰ç„¡ data raceã€ | ã€ŒSafe Rust ä¿è­‰ç„¡ï¼›unsafe æŠŠè²¬ä»»äº¤å›é–‹ç™¼è€…ã€ |
| Kotlin çš„èƒ½åŠ›é‚Šç•Œ | ã€Œæœ¬è³ªä¸Šåšä¸åˆ°ã€ | ã€Œç„¡æ³•åšåˆ°èªè¨€å±¤ç´šçš„å®Œæ•´å¼·åˆ¶ä¿è­‰ï¼Œä½†æœ‰é™çš„éœæ…‹åˆ†æå·¥å…·å­˜åœ¨ã€ |
| Borrow Checker çš„ä»£åƒ¹ | æœªæåŠ | æœ‰ false positiveï¼Œé€¼é–‹ç™¼è€…ç”¨ RefCell / Arc é™ç´šåˆ° runtime æª¢æŸ¥ [^1] |
| ç†è«–åŸºç¤ | æœªæåŠ | Rust çš„ borrow checker æºè‡ªæ•¸å­¸é‚è¼¯çš„ **Affine Type Theory** [^2][^3] |


***

## äºŒã€è·¨åŸŸé€£çµ â€” ä¸‰å€‹æ·±å±¤é¡æ¯”

### ğŸ”¢ é€£çµ 1ï¼šæ•¸å­¸é‚è¼¯ â€” Affine Type Theoryï¼ˆæœ€é‡è¦ï¼‰

Rust çš„ borrow checker **ä¸æ˜¯å·¥ç¨‹å¸«ç™¼æ˜çš„é»‘é­”æ³•**ï¼Œè€Œæ˜¯æœ‰åš´æ ¼çš„æ•¸å­¸ç†è«–æ ¹åŸºã€‚å…¶æœ¬è³ªæ˜¯ **Affine Type System**ï¼ˆä»¿å°„å‹åˆ¥ç³»çµ±ï¼‰ï¼Œæºè‡ª Jean-Yves Girard 1987 å¹´æå‡ºçš„ **Linear Logic**ï¼ˆç·šæ€§é‚è¼¯ï¼‰ã€‚[^3][^4]


| å‹åˆ¥ç³»çµ± | è¦å‰‡ | èªè¨€ |
| :-- | :-- | :-- |
| **Linear Types** | è³‡æºå¿…é ˆä½¿ç”¨**æ°å¥½ä¸€æ¬¡** | Haskellï¼ˆGHC Linear Typesï¼‰ |
| **Affine Types** | è³‡æºæœ€å¤šä½¿ç”¨**ä¸€æ¬¡**ï¼ˆå¯ä¸Ÿæ£„ï¼‰ | **Rust**ï¼ˆdrop å³ä¸Ÿæ£„ï¼‰ |
| ç„¡é™åˆ¶å¼•ç”¨ | è³‡æºå¯ä½¿ç”¨**ä»»æ„å¤šæ¬¡** | Kotlinã€Javaã€Python |

Rust é¸æ“‡ affine è€Œé strict linearï¼Œæ­£æ˜¯ç‚ºäº†å…è¨± `drop`ï¼ˆä¸Ÿæ£„å€¼è€Œä¸ä½¿ç”¨ï¼‰ï¼Œé€™å€‹è¨­è¨ˆé¸æ“‡è®“å¯¦ç”¨æ€§å’Œå®‰å…¨æ€§å–å¾—å¹³è¡¡ ã€‚**é€™æ„å‘³è‘— Kotlin ç„¡æ³•åšåˆ° Rust çš„äº‹ï¼Œæ ¹æœ¬åŸå› ä¸æ˜¯å·¥ç¨‹å•é¡Œï¼Œè€Œæ˜¯å®ƒçš„å‹åˆ¥ç³»çµ±ç¼ºä¹ affine/linear çµæ§‹**ã€‚[^2]

***

### ğŸ›ï¸ é€£çµ 2ï¼šç¶“æ¿Ÿå­¸ â€” ç”¢æ¬Šç†è«–ï¼ˆå…¬åœ°æ‚²åŠ‡ï¼‰

Rust çš„ Ownership æ¨¡å‹èˆ‡è«¾è²çˆ¾ç¶“æ¿Ÿå­¸çš„ **ã€Œå…¬åœ°æ‚²åŠ‡ã€ï¼ˆTragedy of the Commonsï¼‰** å®Œå…¨åŒæ§‹ï¼š

- **å…±äº«çš„ mutable state** = æ²’æœ‰æ˜ç¢ºç”¢æ¬Šçš„å…¬å…±ç‰§å ´ï¼Œäººäººéƒ½å¯ä»¥è®€å¯« â†’ æœ€çµ‚è¢«ç ´å£ï¼ˆdata race / corruptionï¼‰
- **Rust çš„ Ownership** = åœŸåœ°ç§æœ‰åŒ–ï¼ŒåŒä¸€æ™‚é–“åªæœ‰ä¸€å€‹æ‰€æœ‰äººï¼Œç§Ÿå€Ÿæ™‚æ˜ç¢ºæœŸé™ï¼ˆlifetimeï¼‰

Kotlin çš„ GC æ¨¡å‹å…è¨±å¤šå€‹ç‰©ä»¶ã€Œå…±åŒæŒæœ‰ã€åŒä¸€å¡Šè¨˜æ†¶é«”ï¼Œé€™åœ¨å‹åˆ¥ç³»çµ±å±¤é¢æ˜¯ã€Œå…¬åœ°ã€ã€‚Rust å¾æ ¹æœ¬ä¸Šæ¶ˆæ»…å…¬åœ°ï¼Œè®“æ¯å¡Šè¨˜æ†¶é«”åœ¨æ¯å€‹æ™‚é–“é»éƒ½æœ‰**å”¯ä¸€æ˜ç¢ºçš„æ‰€æœ‰äºº**ã€‚

***

### âš›ï¸ é€£çµ 3ï¼šç‰©ç†å­¸ â€” æ³¡åˆ©ä¸ç›¸å®¹åŸç†

Rust Rule 1ï¼ˆå”¯ä¸€å¯è®Šï¼‰èˆ‡ **Pauli Exclusion Principle** é«˜åº¦é¡æ¯”ï¼š

> ã€Œå…©å€‹è²»ç±³å­ä¸èƒ½åŒæ™‚ä½”æ“šåŒä¸€é‡å­æ…‹ã€= ã€Œå…©å€‹ `&mut` ä¸èƒ½åŒæ™‚æŒ‡å‘åŒä¸€å€‹è¨˜æ†¶é«”ä½ç½®ã€

é€™ä¸æ˜¯å·§åˆï¼Œè€Œæ˜¯å°ã€Œè³‡æºæ’ä»–æ€§ã€çš„åŒä¸€æ•¸å­¸çµæ§‹åœ¨ä¸åŒé ˜åŸŸçš„é«”ç¾ï¼šç‰©ç†ä¸–ç•Œé è‡ªç„¶è¦å¾‹å¼·åˆ¶åŸ·è¡Œï¼ŒRust é ç·¨è­¯å™¨å¼·åˆ¶åŸ·è¡Œï¼ŒKotlin å‰‡é é–‹ç™¼è€…è‡ªå¾‹â€”â€”è€Œè‡ªå¾‹æ˜¯æœ€è„†å¼±çš„é˜²ç·šã€‚

***

## âœ¨ æ¹§ç¾æ´è¦‹å€å¡Š

> ä»¥ä¸‹æ˜¯æ•´åˆä¸‰å€‹è·¨åŸŸé¡æ¯”å¾Œã€Œ1+1>2ã€çš„æ¹§ç¾æ´è¦‹ï¼š

**æ´è¦‹ Aï¼šRust çš„çœŸæ­£å‰µæ–°ä¸æ˜¯ã€Œè¨˜æ†¶é«”å®‰å…¨ã€ï¼Œè€Œæ˜¯ã€Œè®“éæ³•ç‹€æ…‹åœ¨å‹åˆ¥ç³»çµ±ä¸­ç„¡æ³•è¡¨é”ã€**

Borrow checker çš„æœ¬è³ªæ˜¯ï¼šæŠŠã€Œå¯èƒ½å¼•ç™¼ data race çš„ç¨‹å¼çµæ§‹ã€è¨­è¨ˆæˆ**ç·¨è­¯å™¨æ ¹æœ¬ç„¡æ³•è¡¨é”çš„ç‹€æ…‹**ï¼Œè€Œä¸æ˜¯ã€Œè¡¨é”äº†å†å»åµæ¸¬ã€ã€‚é€™å€‹å“²å­¸ï¼ˆMake Illegal States Unrepresentableï¼‰å¯ä»¥æ¨å»£åˆ°ä»»ä½•é ˜åŸŸâ€”â€”è³‡æ–™åº«äº¤æ˜“éš”é›¢ã€æª”æ¡ˆç³»çµ±ä¸¦ç™¼å­˜å–ã€API ç‹€æ…‹æ©Ÿè¨­è¨ˆï¼ŒRust åªæ˜¯ç¬¬ä¸€å€‹åœ¨ç³»çµ±ç¨‹å¼èªè¨€å±¤é¢å¾¹åº•å¯¦è¸å®ƒçš„èªè¨€ ã€‚[^5]

**æ´è¦‹ Bï¼šKotlin çš„å¤©èŠ±æ¿æ˜¯ GCï¼Œä¸æ˜¯å·¥ç¨‹å¸«çš„åŠªåŠ›**

åªè¦ Kotlin ä¿ç•™ GCï¼Œå°±æ°¸é ç„¡æ³•åœ¨èªè¨€å±¤é¢è¿½è¹¤ aliasingã€‚é€™ä¸æ˜¯ Kotlin åœ˜éšŠä¸å¤ è°æ˜ï¼Œè€Œæ˜¯ GC èˆ‡ affine type ç³»çµ±åœ¨æ ¹æœ¬è¨­è¨ˆå“²å­¸ä¸Šäº’æ–¥ï¼šGC çš„å­˜åœ¨å‰ææ˜¯ã€Œå¤šå€‹ reference å¯ä»¥æŒ‡å‘åŒä¸€å€‹ç‰©ä»¶ã€ï¼Œè€Œ affine type çš„å­˜åœ¨å‰ææ˜¯ã€Œæ¯å€‹å€¼æœ€å¤šæœ‰ä¸€å€‹æ‰€æœ‰è€…ã€ ã€‚[^6][^2]

***

## ğŸ§ª ä¸‰å€‹å¯æ¸¬è©¦æ–°å‡èªª

**å‡èªª H1ï¼šã€Œå‹åˆ¥ç³»çµ±æ±ºå®šè«–ã€**
> æ‰€æœ‰ä»¥ GC ç‚ºåŸºç¤çš„èªè¨€ï¼ˆJavaã€Kotlinã€Goã€C\#ã€Pythonï¼‰ï¼Œåœ¨ä¸å¼•å…¥ affine/linear type ç³»çµ±çš„å‰æä¸‹ï¼Œç„¡æ³•åœ¨ compile time é”åˆ° Rust ç´šåˆ¥çš„ data race å®Œæ•´é˜²ç¦¦ã€‚é€™å¯ä»¥ç”¨å½¢å¼åŒ–èªè¨€èªç¾©å­¸çš„æ–¹æ³•ï¼Œç‚ºæ¯ç¨® GC èªè¨€å»ºæ¨¡ä¸¦æ•¸å­¸è­‰æ˜å…¶å‹åˆ¥ç³»çµ±çš„è¡¨é”ä¸Šé™ã€‚

**å‡èªª H2ï¼šã€ŒèªçŸ¥æˆæœ¬æ›å– Debug æ™‚é–“ã€**
> Borrow Checker çš„å­¸ç¿’æ›²ç·šï¼ˆé«˜ compile-time æ‹’çµ•ç‡ï¼‰åœ¨åˆæœŸæœƒå¢åŠ é–‹ç™¼è€…èªçŸ¥è² æ“”ï¼Œä½†åœ¨ codebase è¦æ¨¡è¶…é N è¬è¡Œå¾Œï¼Œå›  data race bug æ¶ˆæ»…æ‰€ç¯€çœçš„ debug æ™‚é–“å°‡å‘ˆæŒ‡æ•¸è¶…è¶Šé€™å€‹æˆæœ¬ã€‚å¯è¨­è¨ˆå°ç…§å¯¦é©—ï¼šåŒç­‰è¦æ¨¡çš„ Rust vs Kotlin ä¸¦ç™¼ç³»çµ±ï¼Œæ¯”è¼ƒ bug åµæ¸¬æ™‚æ©Ÿèˆ‡ä¿®å¾©æˆæœ¬ã€‚

**å‡èªª H3ï¼šã€ŒUnsafe ä½¿ç”¨ç‡èˆ‡ Bug å¯†åº¦æ­£ç›¸é—œã€**
> Rust ç”Ÿæ…‹ä¸­ï¼Œ`unsafe` ä½¿ç”¨ç‡è¼ƒé«˜çš„ cratesï¼Œå…¶ CVEï¼ˆå®‰å…¨æ¼æ´ï¼‰å¯†åº¦æ‡‰é¡¯è‘—é«˜æ–¼ç´” safe Rust çš„ cratesï¼Œä¸” bug é¡å‹æ‡‰é«˜åº¦é›†ä¸­åœ¨ data race / use-after-freeã€‚é€™å¯ç”¨ crates.io + GitHub Advisory Database é€²è¡Œçµ±è¨ˆé©—è­‰ ã€‚[^7]

***

## ğŸ’¡ ç¶²èªŒæ•˜äº‹æ¡†æ¶å»ºè­°ï¼ˆçµ¦ Writer çš„çµæ§‹ææ¡ˆï¼‰

| æ®µè½ | æ ¸å¿ƒæ¦‚å¿µ | é—œéµ Hook |
| :-- | :-- | :-- |
| **é–‹å ´** | ç”¨ã€Œå…¬åœ°æ‚²åŠ‡ã€é¡æ¯”å¸¶å…¥å•é¡Œ | ã€Œè¨˜æ†¶é«”ï¼Œæ˜¯è¢«æ‰€æœ‰åŸ·è¡Œç·’å…±äº«çš„å…¬åœ°ã€ |
| **Rust çš„ç­”æ¡ˆ** | Affine Type + ä¸‰æ¢è¦å‰‡ | ã€Œæ•¸å­¸é‚è¼¯ï¼Œä¸æ˜¯è°æ˜çš„é»‘é­”æ³•ã€ |
| **Kotlin çš„å¤©èŠ±æ¿** | GC èˆ‡ affine type çš„æ ¹æœ¬äº’æ–¥ | ã€Œä¸æ˜¯ Kotlin ä¸åŠªåŠ›ï¼Œæ˜¯ GC æ±ºå®šäº†ä¸Šé™ã€ |
| **èª å¯¦çš„ Caveat** | unsafe çš„å­˜åœ¨ | ã€ŒRust çš„ä¿è­·ç½©æœ‰ä¸€å€‹é–‹é—œï¼Œå« unsafeã€ |
| **å¤§å±€è§€** | èªè¨€è¨­è¨ˆå“²å­¸çš„å…‰è­œ | SPARKâ†’Rustâ†’Goâ†’Kotlin çš„å®‰å…¨æ€§é€£çºŒé«” [^5] |
| **çµèª** | æ¹§ç¾æ´è¦‹ A | ã€ŒçœŸæ­£çš„å‰µæ–°ï¼šè®“éæ³•ç‹€æ…‹ç„¡æ³•è¢«è¡¨é”ã€ |


***

**å»ºè­°ä¸‹ä¸€æ­¥**ï¼šç´ æå·²ååˆ†å®Œæ•´ï¼Œå¯ç›´æ¥å‘¼å« `Writer:` ä¾æ­¤æ¡†æ¶ç”¢å‡ºå®Œæ•´ç¶²èªŒè‰ç¨¿ã€‚
<span style="display:none">[^10][^11][^12][^13][^14][^15][^16][^17][^8][^9]</span>

<div align="center">â‚</div>

[^1]: https://news.ycombinator.com/item?id=42485536

[^2]: https://timhwang21.gitbook.io/index/blog/2020

[^3]: https://corecursive.com/016-moves-and-borrowing-in-rust-with-jim-blandy/

[^4]: https://www.youtube.com/watch?v=BWuozpQ_Of8

[^5]: https://uplatz.com/blog/memory-safety-in-systems-programming-a-comparative-analysis-of-modern-alternatives-to-c-c/

[^6]: https://www.reddit.com/r/rust/comments/t9972l/did_rust_first_introduce_the_ownership_concept/

[^7]: https://rustmagazine.org/issue-3/understand-unsafe-rust

[^8]: https://verdagon.dev/blog/linear-types-borrowing

[^9]: https://erikmcclure.com/blog/stop-making-me-memorize-borrow-checker/

[^10]: https://faultlore.com/blah/linear-rust/

[^11]: https://peerdh.com/es/blogs/programming-insights/understanding-type-safety-in-swift-compared-to-other-languages

[^12]: https://stanford-cs242.github.io/f19/assignments/assign6/

[^13]: https://swiftology.io/articles/structural-typing

[^14]: https://stackoverflow.com/questions/37707403/what-is-the-difference-between-type-safety-and-type-inference

[^15]: https://arxiv.org/html/2503.21691v3

[^16]: https://users.rust-lang.org/t/math-behind-borrow-checker/37079

[^17]: https://www.aidanf.net/learn-swift/types_and_type_inference

